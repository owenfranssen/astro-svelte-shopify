---
import Layout from '../../templates/Layout.astro';
import Filters from '../../molecules/collections/Filters.astro';
import MobileFilters from '../../molecules/collections/MobileFilters.astro';
import ImageTextBanner from '../../molecules/ImageTextBanner.astro';
import ProductCard from '../../molecules/ProductCardPortrait.astro';
import json from '../../data/collections.json';
import { getProductsByTag } from '../../routes/api/get-products-by-tag.js';

export async function getStaticPaths({paginate}) {
	const collections = json.collections;
	return await Promise.all( collections.map( async (c) => {
		const query = `tag:'collection:${c.handle}'`,
			products = await getProductsByTag(query),
			collection = { ...c, products: products.edges };
		return {
			params: {
				collectionHandle: c.handle
			},
			props: { collection },
		};
	} ));
}

const { collectionHandle } = Astro.params;
const { collection } = Astro.props;

/*
Uses a hard coded json config to define collections and handles
The Shopify starter plan dows not offer collections
*/
---

<Layout title={ collection.title } description={ collection.description }>
  <MobileFilters />

  <main>
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <div class="py-24 text-center">
        <h1 class="text-4xl font-extrabold tracking-tight text-gray-900">{ collection.title }</h1>
        <p class="mt-4 max-w-3xl mx-auto text-base text-gray-500">{ collection.description }</p>
      </div>

      <Filters />

      <!-- Product grid -->
      <section aria-labelledby="products-heading" class="mt-8">
        <h2 id="products-heading" class="sr-only">Products</h2>

        <div class="grid grid-cols-1 gap-y-10 sm:grid-cols-2 gap-x-6 lg:grid-cols-3 xl:gap-x-8">
          { collection.products.map( product => {
            return <ProductCard product={product.node} />
          }) }
        </div>
      </section>

      <!-- <ImageTextBanner /> -->
    </div>
  </main>
</Layout>